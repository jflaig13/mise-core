{% extends "base_payroll.html" %}

{% block title %}Weekly Shifties{% endblock %}

{% block subheader %}
<!-- Title + Period Selector Row -->
<div class="px-4 pt-3 flex items-center justify-between mise-container">
    <!-- Title on left -->
    <h1 class="text-2xl font-bold">Weekly Shifties</h1>

    <!-- Period Selector on right -->
    {% if period %}
    <div class="flex items-center space-x-1">
        <!-- Previous Period Arrow -->
        {% if period.previous() %}
        <a href="/payroll/period/{{ period.previous().id }}"
           class="p-1.5 text-mise-navy/50 hover:text-mise-navy transition-colors rounded hover:bg-mise-navy/5"
           title="{{ period.previous().label }}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
        </a>
        {% else %}
        <span class="p-1.5 text-mise-navy/20">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
        </span>
        {% endif %}

        <!-- Period Dropdown -->
        <div class="relative">
            <select id="period-selector"
                    class="bg-white border border-mise-navy/20 text-sm rounded-lg px-3 py-1.5
                           text-mise-navy focus:border-mise-green focus:outline-none appearance-none pr-8"
                    onchange="window.location.href='/payroll/period/' + this.value">
                {% for p in periods %}
                <option value="{{ p.id }}" {% if p.id == period.id %}selected{% endif %}>
                    {{ p.label }}{% if p.is_current() %} *{% endif %}
                </option>
                {% endfor %}
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                <svg class="w-4 h-4 text-mise-navy/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
            </div>
        </div>

        <!-- Next Period Arrow -->
        {% if period.next() %}
        <a href="/payroll/period/{{ period.next().id }}"
           class="p-1.5 text-mise-navy/50 hover:text-mise-navy transition-colors rounded hover:bg-mise-navy/5"
           title="{{ period.next().label }}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        </a>
        {% else %}
        <span class="p-1.5 text-mise-navy/20">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        </span>
        {% endif %}
    </div>
    {% endif %}
</div>
<!-- Pay period label - hidden on mobile since period selector shows the date -->
<div class="px-4 pb-3">
    <p class="text-mise-navy/60 hidden sm:block">{{ pay_period }}</p>
    {% if message %}
    <p class="text-green-600 mt-1">{{ message }}</p>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<div class="p-4 pt-0">
    <!-- Progress bar -->
    {% set completed = shifties | selectattr('status', 'equalto', 'complete') | list | length %}
    <div class="mb-6">
        <div class="flex justify-between text-sm text-mise-navy/60 mb-1">
            <span>Progress</span>
            <span>{{ completed }}/14 shifties</span>
        </div>
        <div class="w-full bg-mise-navy/10 rounded-full h-2">
            <div class="bg-green-500 h-2 rounded-full transition-all duration-500"
                 style="width: {{ (completed / 14 * 100) | int }}%"></div>
        </div>
    </div>

    <!-- Shifty grid -->
    <div class="mise-stagger grid grid-cols-2 gap-3">
        {% for shifty in shifties %}
        <a href="{% if shifty.status == 'complete' %}/payroll/period/{{ period.id }}/detail/{{ shifty.code }}{% elif shifty.status == 'pending' %}/payroll/period/{{ period.id }}/approve/{{ shifty.code }}{% else %}/payroll/period/{{ period.id }}/record/{{ shifty.code }}{% endif %}"
           class="mise-card-interactive block p-4 rounded-xl transition-all duration-200 active:scale-95
                  {% if shifty.status == 'complete' %}
                  mise-accent-left-green
                  {% elif shifty.status == 'pending' %}
                  mise-accent-left-navy
                  {% endif %}">
            <div class="flex justify-between items-start">
                <div>
                    <div class="text-lg font-semibold">{{ shifty.label.split()[0][:3] }}</div>
                    <div class="text-sm text-mise-navy/50">{{ 'AM' if 'AM' in shifty.code else 'PM' }}</div>
                </div>
                {% if shifty.status == 'complete' %}
                <span class="mise-badge mise-badge-green">Done</span>
                {% elif shifty.status == 'pending' %}
                <span class="mise-badge mise-badge-yellow">Review</span>
                {% else %}
                <span class="text-mise-navy/20 text-xl">â—‹</span>
                {% endif %}
            </div>
            <div class="text-xs text-mise-navy/40 mt-2">{{ shifty.date }}</div>
            <div class="text-xs mt-1 {% if shifty.status == 'complete' %}text-green-600{% elif shifty.status == 'pending' %}text-yellow-600{% else %}text-mise-navy/30{% endif %}">
                {% if shifty.status == 'complete' %}View details{% elif shifty.status == 'pending' %}Review & approve{% else %}Not recorded{% endif %}
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Quick actions -->
    <div class="mt-6 space-y-3">
        <a href="/payroll/period/{{ period.id }}"
           class="block w-full p-4 bg-mise-green hover:bg-mise-green-dark rounded-xl text-center font-semibold text-white transition-colors mise-btn-primary">
            Record a Shifty
        </a>
        <a href="/payroll/period/{{ period.id }}/totals"
           class="block w-full p-3 bg-white border border-mise-green/20 hover:border-mise-green/40 rounded-lg text-center text-mise-navy/60 transition-colors">
            View Weekly Totals
        </a>
        <a href="/payroll/period/{{ period.id }}/reset"
           class="block w-full p-3 bg-white border border-mise-green/20 hover:border-mise-green/40 rounded-lg text-center text-sm text-mise-navy/40 transition-colors">
            Reset All (Demo)
        </a>
    </div>
</div>
{% endblock %}
